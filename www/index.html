<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8" />
    <title>Uccello volante</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
        }

        body {
            background: #111827;
            color: #e5e7eb;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        .game-wrapper {
            background: #020617;
            border-radius: 16px;
            padding: 16px 20px 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            width: 420px;
            max-width: 100%;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #f9fafb;
        }

        .score {
            font-size: 0.95rem;
            padding: 4px 10px;
            border-radius: 999px;
            background: #0f172a;
            border: 1px solid #1f2937;
        }

        .score span {
            font-weight: 700;
            color: #22c55e;
        }

        .game-area {
            position: relative;
            margin-top: 6px;
            width: 100%;
            max-width: 380px;
            height: 540px;
            border-radius: 12px;
            overflow: hidden;
            background: radial-gradient(circle at top, #1f2937 0, #020617 60%);
            border: 2px solid #1f2937;
            margin-inline: auto;
            touch-action: none; /* niente scroll durante drag su mobile */
        }

        .lane {
            position: absolute;
            top: 0;
            bottom: 0;
            width: 2px;
            background: rgba(148,163,184,0.15);
            left: 33.33%;
        }
        .lane:nth-child(2) {
            left: 66.66%;
        }

        .player {
            position: absolute;
            width: 60px;
            height: 60px;
            background: #3b82f6;
            border-radius: 12px;
            box-shadow: 0 0 12px rgba(59,130,246,0.7);
            left: 50%;
            top: 400px; /* posizione iniziale approssimativa, verrà settata da JS */
            transform: translateX(-50%);
            cursor: grab;
            touch-action: none;
        }

        .player:active {
            cursor: grabbing;
        }

        .obstacle {
            position: absolute;
            width: 60px;
            height: 60px;
            background: #ef4444;
            border-radius: 12px;
            box-shadow: 0 0 10px rgba(248,113,113,0.9);
        }

        .hud {
            margin-top: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 8px;
            font-size: 0.85rem;
        }

        .btn {
            padding: 6px 14px;
            border-radius: 999px;
            border: none;
            background: linear-gradient(135deg, #22c55e, #16a34a);
            color: #022c22;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.08s ease, box-shadow 0.08s ease, opacity 0.15s;
            box-shadow: 0 4px 10px rgba(16,185,129,0.4);
            white-space: nowrap;
        }
        .btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 6px 14px rgba(16,185,129,0.7);
        }
        .btn:active {
            transform: translateY(0);
            box-shadow: 0 2px 6px rgba(16,185,129,0.4);
            opacity: 0.9;
        }

        .instructions {
            color: #9ca3af;
            line-height: 1.4;
        }

        .highlight {
            color: #e5e7eb;
            font-weight: 600;
        }

        .game-over-overlay {
            position: absolute;
            inset: 0;
            background: rgba(15,23,42,0.92);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            gap: 10px;
            text-align: center;
            padding: 0 20px;
            color: #e5e7eb;
            z-index: 20;
        }

        .game-over-overlay h2 {
            font-size: 1.4rem;
            margin-bottom: 4px;
        }

        .game-over-overlay p {
            font-size: 0.9rem;
            color: #9ca3af;
        }

        .best-score {
            font-size: 0.85rem;
            margin-top: 2px;
            color: #a5b4fc;
        }

        @media (max-width: 480px) {
            .game-wrapper {
                width: 100%;
                border-radius: 0;
                min-height: 100vh;
                box-shadow: none;
            }
            body {
                align-items: stretch;
            }
        }
    </style>
</head>
<body>
<div class="game-wrapper">
    <div class="header">
        <div class="title">Uccello volante by Jorge e karim</div>
        <div class="score">Score: <span id="score">0</span></div>
    </div>

    <div class="game-area" id="gameArea">
        <!-- linee decorative -->
        <div class="lane"></div>
        <div class="lane"></div>

        <!-- player -->
        <div class="player" id="player"></div>
    </div>

    <div class="hud">
        <button class="btn" id="startBtn">▶ Start / Restart</button>
        <div class="instructions">
            Trascina il <span class="highlight">player</span> con dito o mouse (su, giù, sinistra, destra).
        </div>
    </div>
</div>

<script>
    const gameArea = document.getElementById("gameArea");
    const playerEl = document.getElementById("player");
    const scoreEl = document.getElementById("score");
    const startBtn = document.getElementById("startBtn");

    let playerX = 0;
    let playerY = 0;
    let playerSpeed = 8; // ancora usato per tastiera se vuoi
    let obstacles = [];
    let lastTimestamp = 0;
    let isRunning = false;
    let score = 0;
    let bestScore = 0;
    let obstacleSpawnTimer = 0;
    let obstacleSpawnInterval = 900;
    let baseFallSpeed = 150;
    let keys = { left: false, right: false, up: false, down: false };

    let isDragging = false;

    function setInitialPlayerPosition() {
        const areaRect = gameArea.getBoundingClientRect();
        const areaWidth = areaRect.width;
        const areaHeight = areaRect.height;

        playerX = areaWidth / 2 - playerEl.offsetWidth / 2;
        // un po' sopra il fondo
        playerY = areaHeight - playerEl.offsetHeight - 20;

        playerEl.style.left = playerX + "px";
        playerEl.style.top = playerY + "px";
    }

    function resetGame() {
        setInitialPlayerPosition();

        obstacles.forEach(o => o.el.remove());
        obstacles = [];

        score = 0;
        scoreEl.textContent = "0";
        obstacleSpawnTimer = 0;
        baseFallSpeed = 150;
        lastTimestamp = performance.now();
    }

    function spawnObstacle() {
        const obstacleEl = document.createElement("div");
        obstacleEl.classList.add("obstacle");

        const areaRect = gameArea.getBoundingClientRect();
        const maxX = areaRect.width - 60;
        const x = Math.random() * maxX;

        obstacleEl.style.left = x + "px";
        obstacleEl.style.top = "-70px";

        gameArea.appendChild(obstacleEl);

        obstacles.push({
            el: obstacleEl,
            x,
            y: -70,
        });
    }

    function updatePlayer() {
        const areaRect = gameArea.getBoundingClientRect();
        const maxX = areaRect.width - playerEl.offsetWidth;
        const maxY = areaRect.height - playerEl.offsetHeight;
        const minX = 0;
        const minY = 0;

        if (keys.left) {
            playerX -= playerSpeed;
        }
        if (keys.right) {
            playerX += playerSpeed;
        }
        if (keys.up) {
            playerY -= playerSpeed;
        }
        if (keys.down) {
            playerY += playerSpeed;
        }

        if (playerX < minX) playerX = minX;
        if (playerX > maxX) playerX = maxX;
        if (playerY < minY) playerY = minY;
        if (playerY > maxY) playerY = maxY;

        playerEl.style.left = playerX + "px";
        playerEl.style.top = playerY + "px";
    }

    function checkCollision(rect1, rect2) {
        return !(
            rect1.right < rect2.left ||
            rect1.left > rect2.right ||
            rect1.bottom < rect2.top ||
            rect1.top > rect2.bottom
        );
    }

    function endGame() {
        isRunning = false;
        isDragging = false;
        if (score > bestScore) {
            bestScore = score;
        }
        showGameOverOverlay();
    }

    function showGameOverOverlay() {
        const oldOverlay = gameArea.querySelector(".game-over-overlay");
        if (oldOverlay) oldOverlay.remove();

        const overlay = document.createElement("div");
        overlay.classList.add("game-over-overlay");

        overlay.innerHTML = `
        <h2>Game Over</h2>
        <div>Score: <strong>${Math.floor(score)}</strong></div>
        <div class="best-score">Best: ${Math.floor(bestScore)}</div>
        <p>Premi <strong>Start / Restart</strong> per riprovare.</p>
      `;

        gameArea.appendChild(overlay);
    }

    function hideGameOverOverlay() {
        const overlay = gameArea.querySelector(".game-over-overlay");
        if (overlay) overlay.remove();
    }

    function gameLoop(timestamp) {
        if (!isRunning) return;

        const delta = timestamp - lastTimestamp;
        lastTimestamp = timestamp;

        updatePlayer();

        const fallSpeed = baseFallSpeed + score * 0.5;
        const deltaY = (fallSpeed * delta) / 1000;

        obstacles.forEach(o => {
            o.y += deltaY;
            o.el.style.top = o.y + "px";
        });

        obstacles = obstacles.filter(o => {
            if (o.y > gameArea.clientHeight + 100) {
                o.el.remove();
                return false;
            }
            return true;
        });

        const playerRect = playerEl.getBoundingClientRect();

        for (const o of obstacles) {
            const obstacleRect = o.el.getBoundingClientRect();
            if (checkCollision(playerRect, obstacleRect)) {
                endGame();
                return;
            }
        }

        obstacleSpawnTimer += delta;
        if (obstacleSpawnTimer >= obstacleSpawnInterval) {
            obstacleSpawnTimer = 0;
            spawnObstacle();
        }

        score += delta * 0.01;
        scoreEl.textContent = Math.floor(score);

        requestAnimationFrame(gameLoop);
    }

    // --- DRAG 2D con pointer events (mouse + touch) ---

    function movePlayerToPointer(e) {
        const rect = gameArea.getBoundingClientRect();
        const pointerX = e.clientX - rect.left;
        const pointerY = e.clientY - rect.top;

        const maxX = rect.width - playerEl.offsetWidth;
        const maxY = rect.height - playerEl.offsetHeight;
        const minX = 0;
        const minY = 0;

        let newX = pointerX - playerEl.offsetWidth / 2;
        let newY = pointerY - playerEl.offsetHeight / 2;

        if (newX < minX) newX = minX;
        if (newX > maxX) newX = maxX;
        if (newY < minY) newY = minY;
        if (newY > maxY) newY = maxY;

        playerX = newX;
        playerY = newY;

        playerEl.style.left = playerX + "px";
        playerEl.style.top = playerY + "px";
    }

    function onPointerDown(e) {
        e.preventDefault();
        isDragging = true;
        movePlayerToPointer(e);
    }

    function onPointerMove(e) {
        if (!isDragging) return;
        e.preventDefault();
        movePlayerToPointer(e);
    }

    function onPointerUp(e) {
        isDragging = false;
    }

    gameArea.addEventListener("pointerdown", onPointerDown, { passive: false });
    window.addEventListener("pointermove", onPointerMove, { passive: false });
    window.addEventListener("pointerup", onPointerUp, { passive: false });
    window.addEventListener("pointercancel", onPointerUp, { passive: false });

    // --- tastiera opzionale ---
    window.addEventListener("keydown", (e) => {
        if (e.key === "ArrowLeft" || e.key === "a" || e.key === "A") {
            keys.left = true;
        }
        if (e.key === "ArrowRight" || e.key === "d" || e.key === "D") {
            keys.right = true;
        }
        if (e.key === "ArrowUp" || e.key === "w" || e.key === "W") {
            keys.up = true;
        }
        if (e.key === "ArrowDown" || e.key === "s" || e.key === "S") {
            keys.down = true;
        }
    });

    window.addEventListener("keyup", (e) => {
        if (e.key === "ArrowLeft" || e.key === "a" || e.key === "A") {
            keys.left = false;
        }
        if (e.key === "ArrowRight" || e.key === "d" || e.key === "D") {
            keys.right = false;
        }
        if (e.key === "ArrowUp" || e.key === "w" || e.key === "W") {
            keys.up = false;
        }
        if (e.key === "ArrowDown" || e.key === "s" || e.key === "S") {
            keys.down = false;
        }
    });

    startBtn.addEventListener("click", () => {
        hideGameOverOverlay();
        resetGame();
        isRunning = true;
        lastTimestamp = performance.now();
        requestAnimationFrame(gameLoop);
    });

    window.addEventListener("load", () => {
        setInitialPlayerPosition();
        showGameOverOverlay();
    });
</script>
</body>
</html>
